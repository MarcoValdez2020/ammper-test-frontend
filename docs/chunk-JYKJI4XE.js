import{ia as l,o as u}from"./chunk-QGAU5XD6.js";import{K as i,O as c,T as a,fa as n,n as r,y as s}from"./chunk-VS4GB3SB.js";var h=class o{apiService=a(l);router=a(u);isAuthenticated=n(this.hasValidToken());currentUser=n(null);hasValidToken(){return!!localStorage.getItem("access_token")}initializeAuth(){this.hasValidToken()?(this.isAuthenticated.set(!0),this.getCurrentUser().subscribe({error:()=>{this.tryRefreshToken()}})):this.tryRefreshToken()}tryRefreshToken(){this.refreshToken().subscribe({next:()=>{this.getCurrentUser().subscribe()},error:()=>{this.isAuthenticated.set(!1)}})}login(e){return this.apiService.post("/auth/login",e).pipe(i(t=>{localStorage.setItem("access_token",t.access_token),this.isAuthenticated.set(!0),this.getCurrentUser().subscribe()}),s(t=>(console.error("Login failed:",t),r(()=>t))))}register(e){return this.apiService.post("/auth/register",e).pipe(i(t=>{localStorage.setItem("access_token",t.access_token),this.isAuthenticated.set(!0),this.getCurrentUser().subscribe()}),s(t=>(console.error("Registration failed:",t),r(()=>t))))}getCurrentUser(){return this.apiService.get("/auth/me").pipe(i(e=>this.currentUser.set(e)),s(e=>(console.error("Failed to get current user:",e),this.logout(),r(()=>e))))}logout(){this.apiService.post("/auth/logout",{}).subscribe({complete:()=>{this.clearAuthData()},error:()=>{this.clearAuthData()}})}clearAuthData(){localStorage.removeItem("access_token"),this.isAuthenticated.set(!1),this.currentUser.set(null),this.router.navigate(["/auth/login"])}refreshToken(){return this.apiService.post("/auth/refresh-token",{}).pipe(i(e=>{localStorage.setItem("access_token",e.access_token),this.isAuthenticated.set(!0)}),s(e=>(console.error("Token refresh failed:",e),localStorage.removeItem("access_token"),this.isAuthenticated.set(!1),this.currentUser.set(null),this.router.navigate(["/auth/login"]),r(()=>e))))}static \u0275fac=function(t){return new(t||o)};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})};export{h as a};
