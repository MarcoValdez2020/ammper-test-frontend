import{a as $}from"./chunk-JYKJI4XE.js";import{l as j,m as z}from"./chunk-76FANQGY.js";import{a as H,b as K,c as Q,d as W}from"./chunk-FTAQ32LW.js";import{b as q,c as G}from"./chunk-GWBNT2LM.js";import{ca as N,ia as R,o as V,ta as A,ua as U,va as J,wa as P}from"./chunk-QGAU5XD6.js";import"./chunk-MD7IQKEC.js";import{$a as b,Ab as M,Gb as F,Ha as I,La as C,O as L,T as p,Wa as x,Xa as v,Y as u,Ya as D,Z as _,Za as y,_a as B,ab as o,bb as i,cb as s,fa as d,jb as f,lb as g,mb as a,tb as O,ua as w,ub as E,v as S,va as l,yb as m,zb as k}from"./chunk-VS4GB3SB.js";var h=class e{apiService=p(R);getAvailableBanks(){return this.apiService.get("/belvo/banks/")}searchBanksByName(n){return this.apiService.get(`/belvo/banks/search?display_name=${encodeURIComponent(n)}`)}createBankConnection(n){return this.apiService.post("/belvo/connections/",n)}getBankConnections(n=1,t=100){return this.apiService.get(`/belvo/connections/?page=${n}&page_size=${t}`)}static \u0275fac=function(t){return new(t||e)};static \u0275prov=L({token:e,factory:e.\u0275fac,providedIn:"root"})};var ee=()=>[1,2,3,4,5],te=(e,n)=>n.id;function ne(e,n){if(e&1&&(o(0,"div",11)(1,"div",12),s(2,"i",13),i(),o(3,"div")(4,"h1",14),m(5,"Bancos Disponibles"),i(),o(6,"p",15),m(7),i()()()),e&2){let t,r=a();l(7),k((t=r.currentUser())==null?null:t.email)}}function ie(e,n){if(e&1){let t=f();o(0,"p-button",16),g("onClick",function(){u(t);let c=a();return _(c.logout())}),i()}e&2&&b("text",!0)}function oe(e,n){e&1&&(o(0,"div",19),s(1,"p-skeleton",20),o(2,"div",21),s(3,"p-skeleton",22)(4,"p-skeleton",23),i(),s(5,"p-skeleton",24),i())}function re(e,n){e&1&&(o(0,"div",17)(1,"p-card"),C(2,oe,6,0,"ng-template",18),i()())}function se(e,n){e&1&&y(0,re,3,0,"div",17,D),e&2&&B(F(0,ee))}function ae(e,n){if(e&1){let t=f();s(0,"p-message",25),o(1,"div",26)(2,"p-button",27),g("onClick",function(){u(t);let c=a();return _(c.loadBanks())}),i()()}if(e&2){let t=a();b("text",t.errorMessage())}}function le(e,n){if(e&1&&s(0,"img",30),e&2){let t=a(2).$implicit;b("src",t.logo,w)("alt",t.display_name)}}function ce(e,n){e&1&&s(0,"i",31)}function me(e,n){if(e&1&&(o(0,"span",35),m(1),i()),e&2){let t=a(2).$implicit;l(),M(" ",t.type," ")}}function pe(e,n){if(e&1&&(o(0,"div",19)(1,"div",29),x(2,le,1,2,"img",30)(3,ce,1,0,"i",31),i(),o(4,"div",32)(5,"h3",33),m(6),i(),o(7,"p",34),m(8),i(),x(9,me,2,1,"span",35),i(),s(10,"i",36),i()),e&2){let t=a().$implicit;l(),E("background-color",t.primary_color||"#3B82F6"),l(),v(t.logo?2:3),l(4),k(t.display_name),l(2),k(t.name),l(),v(t.type?9:-1)}}function de(e,n){if(e&1){let t=f();o(0,"div",17)(1,"p-card",28),g("click",function(){let c=u(t).$implicit,T=a(2);return _(T.selectBank(c))}),C(2,pe,11,6,"ng-template",18),i()()}}function ue(e,n){if(e&1&&y(0,de,3,0,"div",17,te),e&2){let t=a();B(t.filteredBanks())}}function _e(e,n){e&1&&(o(0,"div",10),s(1,"i",37),o(2,"p",38),m(3,"No se encontraron bancos"),i()())}var X=class e{banksService=p(h);authService=p($);router=p(V);isLoading=d(!0);errorMessage=d(null);banks=d([]);filteredBanks=d([]);connections=d([]);currentUser=this.authService.currentUser;ngOnInit(){this.loadBanksAndConnections(),this.currentUser()||this.authService.getCurrentUser().subscribe()}loadBanksAndConnections(){this.isLoading.set(!0),this.errorMessage.set(null),S({banks:this.banksService.getAvailableBanks(),connections:this.banksService.getBankConnections()}).subscribe({next:({banks:n,connections:t})=>{this.banks.set(n.results),this.filteredBanks.set(n.results),this.connections.set(t.results),this.isLoading.set(!1)},error:n=>{console.error("Error loading banks and connections:",n),this.errorMessage.set("Error al cargar los bancos. Verifica tu conexi\xF3n."),this.isLoading.set(!1)}})}loadBanks(){this.loadBanksAndConnections()}onSearch(n){if(!n.trim()){this.filteredBanks.set(this.banks());return}let t=this.banks().filter(r=>r.display_name.toLowerCase().includes(n.toLowerCase())||r.name.toLowerCase().includes(n.toLowerCase()));this.filteredBanks.set(t)}selectBank(n){let t=this.connections().find(r=>r.institution===n.name);t?(sessionStorage.setItem("selectedBank",JSON.stringify(n)),sessionStorage.setItem("selectedConnection",JSON.stringify(t)),this.router.navigate(["/accounts",t.id])):alert(`No tienes cuentas vinculadas al banco ${n.display_name}.`)}logout(){this.authService.logout()}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=I({type:e,selectors:[["app-banks-list"]],decls:14,vars:1,consts:[["searchInput",""],[1,"min-h-screen","bg-gray-50"],["styleClass","border-none shadow-sm bg-white"],["pTemplate","start"],["pTemplate","end"],[1,"p-4"],[1,"relative"],["type","text","pInputText","","placeholder","Buscar banco...",1,"w-full","pl-10",3,"input"],[1,"pi","pi-search","absolute","left-3","top-1/2","transform","-translate-y-1/2","text-gray-400"],[1,"p-4","pt-0"],[1,"text-center","py-8"],[1,"flex","items-center"],[1,"w-8","h-8","bg-blue-600","rounded-full","flex","items-center","justify-center","mr-3"],[1,"pi","pi-building","text-white","text-sm"],[1,"text-xl","font-bold","text-gray-800"],[1,"text-sm","text-gray-600"],["icon","pi pi-sign-out","severity","secondary","pTooltip","Cerrar sesi\xF3n",3,"onClick","text"],[1,"mb-4"],["pTemplate","content"],[1,"flex","items-center","space-x-4"],["shape","circle","size","3rem"],[1,"flex-1"],["width","60%","height","1.2rem","styleClass","mb-2"],["width","40%","height","1rem"],["width","4rem","height","2.5rem"],["severity","error","styleClass","w-full",3,"text"],[1,"text-center","mt-4"],["label","Reintentar","icon","pi pi-refresh",3,"onClick"],["styleClass","cursor-pointer hover:shadow-md transition-shadow duration-200",3,"click"],[1,"w-12","h-12","rounded-full","flex","items-center","justify-center"],[1,"w-8","h-8","rounded-full",3,"src","alt"],[1,"pi","pi-building","text-white"],[1,"flex-1","min-w-0"],[1,"font-semibold","text-gray-800","truncate"],[1,"text-sm","text-gray-600","truncate"],[1,"inline-block","px-2","py-1","text-xs","bg-blue-100","text-blue-800","rounded-full","mt-1"],[1,"pi","pi-chevron-right","text-gray-400"],[1,"pi","pi-search","text-4xl","text-gray-300","mb-4"],[1,"text-gray-500"]],template:function(t,r){if(t&1){let c=f();o(0,"div",1)(1,"p-toolbar",2),C(2,ne,8,1,"ng-template",3)(3,ie,1,1,"ng-template",4),i(),o(4,"div",5)(5,"div",6)(6,"input",7,0),g("input",function(){u(c);let Y=O(7);return _(r.onSearch(Y.value))}),i(),s(8,"i",8),i()(),o(9,"div",9),x(10,se,2,1)(11,ae,3,1)(12,ue,2,0)(13,_e,4,0,"div",10),i()()}t&2&&(l(10),v(r.isLoading()?10:r.errorMessage()?11:r.filteredBanks().length>0?12:13))},dependencies:[U,A,N,P,J,z,j,K,H,G,q,W,Q],encapsulation:2,changeDetection:0})};export{X as BanksListComponent};
