import{a as F}from"./chunk-JYKJI4XE.js";import{a as X,b as G}from"./chunk-CVELUFZD.js";import{a as q,b as J,c as z,d as U}from"./chunk-FTAQ32LW.js";import{b as $,c as P}from"./chunk-GWBNT2LM.js";import{ca as N,ia as B,m as M,o as D,ta as O,ua as V,va as R,wa as j}from"./chunk-QGAU5XD6.js";import"./chunk-MD7IQKEC.js";import{$a as g,Ab as h,Gb as I,Ha as T,La as C,O as w,T as d,Wa as y,Xa as b,Y as u,Ya as L,Z as _,Za as S,_a as k,ab as o,bb as i,cb as m,fa as p,jb as x,lb as f,mb as c,va as a,vb as E,yb as s,zb as v}from"./chunk-VS4GB3SB.js";var A=class t{apiService=d(B);retrieveAccounts(n){return this.apiService.post("/belvo/accounts/",n)}static \u0275fac=function(e){return new(e||t)};static \u0275prov=w({token:t,factory:t.\u0275fac,providedIn:"root"})};var W=()=>[1,2,3],Y=(t,n)=>n.id;function Z(t,n){if(t&1){let e=x();o(0,"div",6)(1,"p-button",7),f("onClick",function(){u(e);let l=c();return _(l.goBack())}),i(),o(2,"div")(3,"h1",8),s(4,"Cuentas"),i(),o(5,"p",9),s(6),i()()()}if(t&2){let e,r=c();a(),g("text",!0),a(5),v(((e=r.selectedBank())==null?null:e.display_name)||"Banco seleccionado")}}function ee(t,n){if(t&1){let e=x();o(0,"p-button",10),f("onClick",function(){u(e);let l=c();return _(l.loadAccounts())}),i()}if(t&2){let e=c();g("text",!0)("loading",e.isLoading())}}function te(t,n){t&1&&(o(0,"div",13)(1,"div",14)(2,"div",15),m(3,"p-skeleton",16)(4,"p-skeleton",17),i(),m(5,"p-skeleton",18),i(),o(6,"div",19),m(7,"p-skeleton",20)(8,"p-skeleton",21),i()())}function ne(t,n){t&1&&(o(0,"div",11)(1,"p-card"),C(2,te,9,0,"ng-template",12),i()())}function ie(t,n){t&1&&S(0,ne,3,0,"div",11,L),t&2&&k(I(0,W))}function oe(t,n){if(t&1){let e=x();m(0,"p-message",22),o(1,"div",23)(2,"p-button",24),f("onClick",function(){u(e);let l=c();return _(l.loadAccounts())}),i()()}if(t&2){let e=c();g("text",e.errorMessage())}}function re(t,n){if(t&1&&(o(0,"span",31),s(1),i()),t&2){let e=c(2).$implicit;a(),h("\u2022 Agencia: ",e.agency)}}function ae(t,n){if(t&1&&(o(0,"div",35),s(1),i()),t&2){let e=c(2).$implicit,r=c(2);a(),h(" Saldo actual: ",r.formatCurrency(e.balance_current,e.currency)," ")}}function ce(t,n){if(t&1&&(o(0,"div",13)(1,"div",14)(2,"div",26)(3,"h3",27),s(4),i(),o(5,"p",28),s(6),i()(),m(7,"p-tag",29),i(),o(8,"div",30)(9,"div",9)(10,"span"),s(11),i(),y(12,re,2,1,"span",31),i(),o(13,"div",32)(14,"p",33),s(15,"Saldo disponible"),i(),o(16,"p",34),s(17),i()()(),y(18,ae,2,1,"div",35),i(),o(19,"div",36),m(20,"i",37),i()),t&2){let e=c().$implicit,r=c(2);a(4),v(e.name),a(2),v(e.number),a(),g("value",e.category)("severity",r.getAccountCategorySeverity(e.category)),a(4),v(e.currency),a(),b(e.agency?12:-1),a(4),E("text-green-600",r.getNumericBalance(e.balance_available)>=0)("text-red-600",r.getNumericBalance(e.balance_available)<0),a(),h(" ",r.formatCurrency(e.balance_available,e.currency)," "),a(),b(e.balance_current!==e.balance_available?18:-1)}}function se(t,n){if(t&1){let e=x();o(0,"div",11)(1,"p-card",25),f("click",function(){let l=u(e).$implicit,K=c(2);return _(K.selectAccount(l))}),C(2,ce,21,12,"ng-template",12),i()()}}function le(t,n){if(t&1&&S(0,se,3,0,"div",11,Y),t&2){let e=c();k(e.accounts())}}function me(t,n){t&1&&(o(0,"div",5),m(1,"i",38),o(2,"p",39),s(3,"No se encontraron cuentas"),i(),o(4,"p",40),s(5,"Este banco no tiene cuentas vinculadas"),i()())}var H=class t{accountsService=d(A);authService=d(F);router=d(D);route=d(M);isLoading=p(!0);errorMessage=p(null);accounts=p([]);selectedBank=p(null);linkId=p("");ngOnInit(){this.route.params.subscribe(e=>{this.linkId.set(e.linkId),this.loadAccounts()});let n=sessionStorage.getItem("selectedBank");n&&this.selectedBank.set(JSON.parse(n))}loadAccounts(){let n=this.linkId();if(!n){this.errorMessage.set("No se proporcion\xF3 un ID de conexi\xF3n v\xE1lido"),this.isLoading.set(!1);return}this.isLoading.set(!0),this.errorMessage.set(null),this.accountsService.retrieveAccounts({link_id:n}).subscribe({next:e=>{this.accounts.set(e.results),this.isLoading.set(!1)},error:e=>{console.error("Error loading accounts:",e),this.errorMessage.set("Error al cargar las cuentas. Verifica tu conexi\xF3n."),this.isLoading.set(!1)}})}selectAccount(n){sessionStorage.setItem("selectedAccount",JSON.stringify(n)),this.router.navigate(["/transactions",n.id])}goBack(){this.router.navigate(["/banks"])}getAccountCategorySeverity(n){switch(n.toLowerCase()){case"checking":case"corriente":return"info";case"savings":case"ahorro":return"success";case"credit":case"credito":return"warn";case"loan":case"prestamo":return"danger";default:return"secondary"}}getNumericBalance(n){return parseFloat(n)||0}formatCurrency(n,e){let r=parseFloat(n);return new Intl.NumberFormat("es-MX",{style:"currency",currency:e||"USD",minimumFractionDigits:2}).format(r)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=T({type:t,selectors:[["app-accounts-list"]],decls:9,vars:1,consts:[[1,"min-h-screen","bg-gray-50"],["styleClass","border-none shadow-sm bg-white"],["pTemplate","start"],["pTemplate","end"],[1,"p-4"],[1,"text-center","py-8"],[1,"flex","items-center"],["icon","pi pi-arrow-left","severity","secondary","styleClass","mr-3",3,"onClick","text"],[1,"text-xl","font-bold","text-gray-800"],[1,"text-sm","text-gray-600"],["icon","pi pi-refresh","severity","secondary","pTooltip","Actualizar cuentas",3,"onClick","text","loading"],[1,"mb-4"],["pTemplate","content"],[1,"space-y-3"],[1,"flex","justify-between","items-start"],[1,"flex-1"],["width","70%","height","1.2rem","styleClass","mb-2"],["width","50%","height","1rem"],["width","4rem","height","1.5rem"],[1,"flex","justify-between"],["width","40%","height","1rem"],["width","30%","height","1.5rem"],["severity","error","styleClass","w-full",3,"text"],[1,"text-center","mt-4"],["label","Reintentar","icon","pi pi-refresh",3,"onClick"],["styleClass","cursor-pointer hover:shadow-md transition-shadow duration-200",3,"click"],[1,"flex-1","min-w-0"],[1,"font-semibold","text-gray-800","truncate"],[1,"text-sm","text-gray-600","truncate"],["styleClass","text-xs",3,"value","severity"],[1,"flex","justify-between","items-center"],[1,"ml-2"],[1,"text-right"],[1,"text-sm","text-gray-500"],[1,"font-bold","text-lg"],[1,"text-xs","text-gray-500","border-t","pt-2"],[1,"flex","justify-end","mt-3"],[1,"pi","pi-chevron-right","text-gray-400"],[1,"pi","pi-wallet","text-4xl","text-gray-300","mb-4"],[1,"text-gray-500"],[1,"text-sm","text-gray-400","mt-2"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"p-toolbar",1),C(2,Z,7,2,"ng-template",2)(3,ee,1,2,"ng-template",3),i(),o(4,"div",4),y(5,ie,2,1)(6,oe,3,1)(7,le,2,0)(8,me,6,0,"div",5),i()()),e&2&&(a(5),b(r.isLoading()?5:r.errorMessage()?6:r.accounts().length>0?7:8))},dependencies:[V,O,N,j,R,J,q,P,$,U,z,G,X],encapsulation:2})};export{H as AccountsListComponent};
